<!DOCTYPE html><html lang="en" class="no-js">
<head>
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Unity - Manual:  Procedural Materials - Memory Usage and Caching Behaviour</title>
<meta name="description" content="The Unity Manual helps you learn and use the Unity engine. With the Unity engine you can create 2D and 3D games, apps and experiences.">
<meta name="author" content="Unity Technologies">
<link rel="shortcut icon" href="../StaticFilesManual/images/favicons/favicon.ico">
<link rel="icon" type="image/png" href="../StaticFilesManual/images/favicons/favicon.png">
<link rel="apple-touch-icon-precomposed" sizes="152x152" href="../StaticFilesManual/images/favicons/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="../StaticFilesManual/images/favicons/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon-precomposed" sizes="120x120" href="../StaticFilesManual/images/favicons/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="../StaticFilesManual/images/favicons/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="../StaticFilesManual/images/favicons/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon-precomposed" href="../StaticFilesManual/images/favicons/apple-touch-icon.png">
<meta name="msapplication-TileColor" content="#222c37">
<meta name="msapplication-TileImage" content="../StaticFilesManual/images/favicons/tileicon-144x144.png">
<script type="text/javascript">
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-2854981-1']);
  _gaq.push(['_setDomainName', 'unity3d.com']);
  _gaq.push(['_trackPageview']);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
  </script><script type="text/javascript" src="../StaticFilesManual/js/jquery.js?ts=1492779482"></script><script type="text/javascript" src="../StaticFilesManual/js/core.js?ts=1492779482"></script><script type="text/javascript" src="docdata/toc.js?ts=1492779482"></script><script type="text/javascript" src="docdata/global_toc.js?ts=1492779482"></script><link href="https://fonts.googleapis.com/css?family=Open+Sans:400,700,400italic" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../StaticFilesManual/css/core.css?ts=1492779482">
</head>
<body>
<div class="header-wrapper">
<div id="header" class="header"><div class="content">
<div class="spacer"><div class="menu">
<div class="logo"><a href="http://docs.unity3d.com"></a></div>
<div class="search-form"><form action="30_search.html" method="get" class="apisearch">
<input type="text" name="q" placeholder="Search manual..." autosave="Unity Reference" results="5" class="sbox field" id="q"><input type="submit" class="submit">
</form></div>
<ul>
<li><a href="../Manual/index.html" class="selected">Manual</a></li>
<li><a href="../ScriptReference/index.html">Scripting API</a></li>
</ul>
</div></div>
<div class="more">
<div class="filler"></div>
<ul><li><a href="http://unity3d.com/">unity3d.com</a></li></ul>
</div>
</div></div>
<div class="toolbar"><div class="content">
<div class="version-number">Version: <b>5.6</b> (<a href="https://docs.unity3d.com/2017.1/Documentation/Manual">switch to 2017.1b</a>)</div>
<div class="lang-switcher">
<div class="current toggle" data-target=".lang-list">
<div class="lbl">Language: <span class="b">English</span>
</div>
<div class="arrow"></div>
</div>
<div class="lang-list" style="display:none;"><ul>
<li><a href="/Manual/ProceduralMaterials-Caching.html">English</a></li>
<li><a href="/ja/current/Manual/ProceduralMaterials-Caching.html">日本語</a></li>
<li><a href="/es/current/Manual/ProceduralMaterials-Caching.html">Español</a></li>
<li><a href="/kr/current/Manual/ProceduralMaterials-Caching.html">한국어</a></li>
<li><a href="/ru/current/Manual/ProceduralMaterials-Caching.html">Русский</a></li>
</ul></div>
</div>
</div></div>
</div>
<div id="master-wrapper" class="master-wrapper clear">
<div id="sidebar" class="sidebar"><div class="sidebar-wrap"><div class="content"><div class="sidebar-menu"><div class="toc"><h2>Unity Manual</h2></div></div></div></div></div>
<div id="content-wrap" class="content-wrap"><div class="content-block"><div class="content">
<div class="section">
<div class="breadcrumbs clear"><ul>
<li><a href="UnityManual.html">Unity User Manual (5.6)</a></li>
<li><a href="Graphics.html">Graphics</a></li>
<li><a href="GraphicsOverview.html">Graphics Overview</a></li>
<li><a href="ProceduralMaterials.html">Procedural Materials</a></li>
<li> Procedural Materials - Memory Usage and Caching Behaviour</li>
</ul></div>
<div class="mb20"><div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="ProceduralMaterials.html"></a></span><div class="tip">Procedural Materials</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="GeneratingMeshGeometryProcedurally.html"></a></span><div class="tip"> Procedural Mesh Geometry</div>
</div>
</div></div>
<h1>Procedural Materials - Memory Usage and Caching Behaviour</h1>
<!--BeginSwitchLink--><!--EndSwitchLink-->
<div class="clear"></div>

<p>Substance (the Procedural Materials engine in Unity) makes use of two forms of caching, and to manage memory and disk usage when using procedural materials it is important to understand how they both behave.</p>

<h2>1) The ‘runtime’ memory cache</h2>

<p>Susbtance allows you to generate dynamic textures (textures that can obey a set of parameters) from a small amount of data. However, in order to generate the textures from the binary data and the parameter values, Substance needs to allocate some memory to store intermediate bitmaps when ‘recompositing’ the desired output textures.</p>

<p>The amount of memory Substance is allowed to use during the texture generation is controlled by <a href="../ScriptReference/ProceduralMaterial-cacheSize.html">ProceduralMaterial.cacheSize</a>.</p>

<p>Once a Procedural Material’s textures have been generated, and according to the current value of cacheSize, the Substance engine can keep some of the intermediate results in memory, in order to speed up subsequent texture computations if the user changes the value of one or several parameters later on.</p>

<p>Once this is done, <a href="../ScriptReference/ProceduralMaterial.ClearCache.html">ProceduralMaterial.ClearCache()</a> forces the Substance engine to release the memory it kept allocated, and to release the storage used to store the data of the input bitmaps if any.</p>

<p>So, the quickest way to lower the memory consumption of the Substance engine once the textures have been computed is as follows:</p>

<pre><code>procMat.cacheSize = ProceduralCacheSize.None;
procMat.ClearCache();
</code></pre>

<p><em>This function can be called per-material, and it’s safe to think of it as such. However under the hood, Substance may optimize space by reusing shared parts of materials (for example if a basic noise pattern is used by two different materials). In addition, depending on the order in which assets are serialized during the build process and loaded at runtime, or even on the performance of the machine the game/app runs on, the merging of assets is not deterministic. Therefore if you are trying to closely track the amount of memory used by each material, this information may help explain if you are seeing unpredictable results.</em></p>

<h2>2) The on-device disk/flash cache</h2>

<p>In order not to pay the texture generation time each time the game/app starts, it is possible to set up the Procedural Material in the editor to use a caching load behaviour.</p>

<figure>
<img src="../uploads/Main/SubstanceLoadBehaviour.png" alt="The Load Behaviour options in the inspector for a Substance material">
<figcaption>The Load Behaviour options in the inspector for a Substance material</figcaption>
</figure>

<p>This option gives you control over when the textures are generated for the first time (either once the asset is loaded for the first time, or the first time the user triggers the texture computation via a script call), how the generated texures are cached, and whether the substance data is kept in memory to allow modification and regeneration at runtime.</p>

<p>The options available are:</p>

<table>
<colgroup>
<col style="text-align:left;">
<col style="text-align:left;">
</colgroup>

<thead>
<tr>
	<th style="text-align:left;">Option Name</th>
	<th style="text-align:left;">Description</th>
</tr>
</thead>

<tbody>
<tr>
	<td style="text-align:left;">Do nothing</td>
	<td style="text-align:left;">Do not generate the textures. RebuildTextures() or RebuildTexturesImmediately() must be called to generate the textures.</td>
</tr>
<tr>
	<td style="text-align:left;">Do nothing and cache</td>
	<td style="text-align:left;">Do not generate the textures. RebuildTextures() or RebuildTexturesImmediately() must be called to generate the textures. After the textures have been generrated for the first time, they are cached to disk/flash to speed up subsequent game/application startups.</td>
</tr>
<tr>
	<td style="text-align:left;">Build on level load</td>
	<td style="text-align:left;">Generate the textures when loading to favor application’s size (default on supported platforms).</td>
</tr>
<tr>
	<td style="text-align:left;">Build on level load and cache</td>
	<td style="text-align:left;">Generate the textures when loading and cache them to disk/flash to speed up subsequent game/application startups.</td>
</tr>
<tr>
	<td style="text-align:left;">Bake and keep Substance</td>
	<td style="text-align:left;">Bake the textures to speed up loading and keep the Procedural Material data so that it can still be tweaked and regenerated later on.</td>
</tr>
<tr>
	<td style="text-align:left;">Bake and discard Substance</td>
	<td style="text-align:left;">Bake the textures to speed up loading and discard the Procedural Material data (default on unsupported platforms).</td>
</tr>
</tbody>
</table>

<p>When the generated textures are cached on-device, the next time the game/app cold starts, the textures are directly loaded from disk, and this is almost as fast as loading regular bitmaps. This means no time is spent generating textures at all, except for the first time the app is run.</p>

<h2>Clearing cached data</h2>

<p>The cached data can be cleared using <a href="../ScriptReference/Caching.CleanCache.html">Caching.CleanCache()</a>. This is the same cache space as is used for any download assetbundle data, so calling <code>CleanCache</code> will clear cached Procedural Material data <em>and</em> downloaded Asset Bundle data.</p>
<div class="nextprev clear">
<div class="icon tt left mr1" data-distance="-40|-30|top">
<span class="prev"><a href="ProceduralMaterials.html"></a></span><div class="tip">Procedural Materials</div>
</div>
<div class="icon tt right" data-distance="-40|-30|top">
<span class="next"><a href="GeneratingMeshGeometryProcedurally.html"></a></span><div class="tip"> Procedural Mesh Geometry</div>
</div>
</div>
</div>
<div class="footer-wrapper"><div class="footer clear">
<div class="copy">
<known_issues><p>Is something described here not working as you expect it to? It might be a <b>Known Issue</b>. Please check with the Issue Tracker at <a href="http://issuetracker.unity3d.com">issuetracker.unity3d.com</a>.</p></known_issues>Copyright © 2017 Unity Technologies. Publication: 5.6-001I. Built: 2017-04-21.</div>
<div class="menu">
<a href="http://unity3d.com/learn">Tutorials</a><a href="http://answers.unity3d.com">Community Answers</a><a href="https://support.unity3d.com/hc/en-us">Knowledge Base</a><a href="http://forum.unity3d.com">Forums</a><a href="http://unity3d.com/asset-store">Asset Store</a>
</div>
</div></div>
</div></div></div>
</div>
<noscript><iframe src="http://www.googletagmanager.com/ns.html?id=GTM-MC35ML" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'http://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-MC35ML');</script>
</body>
</html>
